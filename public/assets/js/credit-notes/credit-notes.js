(()=>{"use strict";route("products.index");var e=route("credit-notes.store"),t=route("credit-notes.index")+"/",i=route("get.creditnote.customer.address");$(document).ready((function(){var i;$("#creditNoteCurrencyId").select2({width:"100%",placeholder:Lang.get("messages.placeholder.select_currency")}),$("#discountTypeSelect").select2({width:"100%",placeholder:Lang.get("messages.placeholder.select_discount_type")}),$(".datepicker").datetimepicker({format:"YYYY-MM-DD HH:mm:ss",useCurrent:!1,sideBySide:!0,maxDate:new Date,icons:{up:"fa fa-chevron-up",down:"fa fa-chevron-down",next:"fa fa-chevron-right",previous:"fa fa-chevron-left"}}),$(".datepicker").on("dp.show",(function(){matchWindowScreenPixels({datepicker:".datepicker"},"exp")})),$(document).on("click","a",(function(e){e.stopPropagation()})),$("#addItemSelectBox").on("select2:select",(function(){var e=$(this).val();$.ajax({url:route("products.edit",e),type:"GET",success:function(e){""!==$(".items-container>tr:last-child").find(".item-name").val()&&$("#itemAddBtn").trigger("click");var t=$(".items-container>tr:last-child"),i=document.createElement("textarea");i.innerHTML=e.data.title,t.find(".item-name").val(i.value),t.find(".item-description").val($(e.data.description).text()),t.find(".qty").val("1").trigger("keyup"),t.find(".rate").val(e.data.rate).trigger("keyup");var a=[];e.data.first_tax&&a.push(e.data.first_tax.id),e.data.second_tax&&a.push(e.data.second_tax.id),t.find(".tax-rates").val(a).trigger("change")}})})),$(document).on("click","#saveAsDraft, #saveAndSend",(function(a){var s=$(this).data("status");if(a.preventDefault(),i)return!1;i=!0;var d=document.getElementById("creditNoteForm"),n=new FormData(d);n.append("payment_status",s);var r,o,p,l,c,h,u,m,f=0,_=[];h=$(".total-numbers").text(),$(".items-container>tr").each((function(){_=[],r=$(this).find(".item-name").val(),o=$(this).find(".item-description").val(),p=$(this).find(".qty").val(),l=$(this).find(".rate").val(),c=$(this).find(".item-amount").text(),$.each($($(this).find(".tax-rates option:selected")),(function(){_.push($(this).val())})),n.append("itemsArr["+f+"][item]",r),n.append("itemsArr["+f+"][description]",o),n.append("itemsArr["+f+"][quantity]",p),n.append("itemsArr["+f+"][rate]",l),n.append("itemsArr["+f+"][total]",c),n.append("itemsArr["+f+"][tax]",_),f++})),$("#taxesListTable>tr").each((function(){u=(u=$(this).find(".tax-value").text()).replace("%",""),m=$(this).find(".footer-tax-numbers").text(),n.append("taxes["+u+"]",m)})),n.append("total_amount",h),n.append("sub_total",$("#subTotal").text()),$.ajax({url:e,type:"POST",data:n,processData:!1,contentType:!1,beforeSend:function(){$(".loader-div").fadeIn()},success:function(e){if(e.success){var i=e.data.id;window.location=t+i}},error:function(e){displayErrorMessage(e.responseJSON.message),i=!1},complete:function(){$(".loader-div").fadeOut()}})})),$(document).on("click","#editSaveAsDraft, #editSaveAndSend",(function(e){var i=$(this).data("status");$("#editAdminNote").summernote("isEmpty")&&$("#editAdminNote").val(""),$("#editClientNote").summernote("isEmpty")&&$("#editClientNote").val(""),$("#editTermAndConditions").summernote("isEmpty")&&$("#editTermAndConditions").val(""),e.preventDefault();var a=document.getElementById("editCreditNoteForm"),s=new FormData(a);s.append("payment_status",i);var d,n,r,o,p,l,c,h,u=0,m=[];l=$(".total-numbers").text(),$(".items-container>tr").each((function(){m=[],d=$(this).find(".item-name").val(),n=$(this).find(".item-description").val(),r=$(this).find(".qty").val(),o=$(this).find(".rate").val(),p=$(this).find(".item-amount").text(),$.each($($(this).find(".tax-rates option:selected")),(function(){m.push($(this).val())})),s.append("itemsArr["+u+"][item]",d),s.append("itemsArr["+u+"][description]",n),s.append("itemsArr["+u+"][quantity]",r),s.append("itemsArr["+u+"][rate]",o),s.append("itemsArr["+u+"][total]",p),s.append("itemsArr["+u+"][tax]",m),u++})),$("#taxesListTable>tr").each((function(){c=(c=$(this).find(".tax-value").text()).replace("%",""),h=$(this).find(".footer-tax-numbers").text(),s.append("taxes["+c+"]",h)})),s.append("total_amount",l),s.append("sub_total",$("#subTotal").text());var f=$("#hdnCreditNoteId").val();$.ajax({url:t+f,type:"POST",data:s,processData:!1,contentType:!1,beforeSend:function(){$(".loader-div").fadeIn()},success:function(e){if(e.success){var i=e.data.id;window.location=t+i}},error:function(e){displayErrorMessage(e.responseJSON.message)},complete:function(){$(".loader-div").fadeOut()}})})),"undefined"!=typeof creditNoteEdit&&creditNoteEdit&&($(".tax-rates").trigger("change"),$(".qty").trigger("keyup"),$("#adjustment").trigger("keyup"),window.calculateSubTotal(),$("#creditNoteNumber").attr("readonly",!0),$(".address-modal").trigger("hidden.bs.modal")),$(".address-modal").on("show.bs.modal",(function(){setTimeout((function(){$("#billStreet").focus()}),500)})),window.checkBillAddressFields=function(){return $("#billStreet,#billCity,#billState,#billZipCode,#billCountry").filter((function(){return""!=this.value}))},window.showBillingShippingAddressError=function(e){displayErrorMessage($(e).data("err-msg"))};$(document).on("change","#shippingAddressEnable",(function(){$(this).prop("checked")||"undefined"==typeof createData&&"undefined"==typeof editData||($("#shipStreet").val(""),$("#copyBillingAddress").prop("checked",!1),$("#shipStreet,#shipCity,#shipState,#shipZipCode,#shipCountry").val(""))})),window.checkStreetField=function(){return""===$.trim($("#billStreet").val())?(showBillingShippingAddressError("#billStreet"),!1):!$("#shippingAddressEnable").prop("checked")||""!==$.trim($("#shipStreet").val())||(showBillingShippingAddressError("#shipStreet"),!1)};var a=$("#addressForm"),s=$("#shippingAddressForm");"undefined"!=typeof editCreditNoteAddress&&editCreditNoteAddress&&(0==checkBillAddressFields().length?$("#bill_to").html("_ _ _ _ _ _"):$("#bill_to").html(getAddressDetail(a)),""!=$("#shipStreet").val()?$("#ship_to").html(getAddressDetail(s)):$("#ship_to").html("_ _ _ _ _ _")),$(document).on("click","#btnSave",(function(){if(!checkStreetField())return!1;"undefined"!=typeof createCreditNoteAddress&&createCreditNoteAddress&&(0==checkBillAddressFields().length?$("#bill_to").html("_ _ _ _ _ _"):$("#bill_to").html(createAddressDetail(a)),1==$("#shippingAddressEnable").prop("checked")&&""!=$("#shipStreet").val()?$("#ship_to").html(createAddressDetail(s)):$("#ship_to").html("_ _ _ _ _ _")),"undefined"!=typeof editCreditNoteAddress&&editCreditNoteAddress&&(0==checkBillAddressFields().length?$("#bill_to").html("_ _ _ _ _ _"):$("#bill_to").html(getAddressDetail(a)),1==$("#shippingAddressEnable").prop("checked")&&""!=$("#shipStreet").val()?$("#ship_to").html(getAddressDetail(s)):$("#ship_to").html("_ _ _ _ _ _")),$(".address-modal").modal("hide")})),"undefined"!=typeof editData&&""!==$.trim($("#shipStreet").val())&&($("#shippingAddressEnable").prop("checked",!0),$("#shippingAddressForm").slideDown(),$("#shipStreet").val()),$(document).on("click","#markAsDraft, #markAsOpen, #markAsVoid, #markAsClosed",(function(){var e=$(this).data("status");$.ajax({url:changePaymentStatus,type:"put",data:{paymentStatus:e},success:function(e){e.success&&(window.location.href=creditNoteId,displaySuccessMessage(e.message))},error:function(e){displayErrorMessage(e.responseJSON.message)}})}))})),""!==$("#customerSelectBox").val()&&setTimeout((function(){$("#customerSelectBox").trigger("change")}),100),$(document).on("change","#customerSelectBox",(function(){var e=$(this).val();$("#shippingAddressEnable").prop("checked",!1),$("#shippingAddressForm").slideUp(),$("#copyBillingAddress").prop("checked",!1),$("#billStreet,#billCity,#billState,#billZipCode,#billCountry").val(""),$("#shipStreet,#shipCity,#shipState,#shipZipCode,#shipCountry").val(""),$.ajax({url:i,type:"GET",data:{customer_id:e},success:function(e){$("#bill_to").empty(),$("#ship_to").empty();var t=e.data[0],i=e.data[1];$("#copyBillingAddress").prop("checked",!0),isEmpty(t)?($("#bill_to").html("_ _ _ _ _ _"),$("#ship_to").html("_ _ _ _ _ _")):($("#bill_to").append("<span>"+t.street+"</span><br>"),$("#bill_to").append("<span>"+t.city+",</span>"),$("#bill_to").append("<span>"+t.state+"</span><br>"),$("#bill_to").append("<span>"+t.country+"-</span>"),$("#bill_to").append("<span>"+t.zip+"</span>"),$("#billStreet").val(e.data[0].street),$("#billCity").val(e.data[0].city),$("#billState").val(e.data[0].state),$("#billZipCode").val(e.data[0].zip),$("#billCountry").val(e.data[0].country)),isEmpty(i)?($("#shippingAddressEnable").prop("checked",!1),$("#shippingAddressForm").slideUp(),$("#copyBillingAddress").prop("checked",!1),$("#ship_to").html("_ _ _ _ _ _")):($("#shippingAddressEnable").prop("checked",!0),$("#shippingAddressForm").slideDown(),$("#copyBillingAddress").prop("checked",!0),$("#ship_to").append("<span>"+i.street+"</span><br>"),$("#ship_to").append("<span>"+i.city+",</span>"),$("#ship_to").append("<span>"+i.state+"</span><br>"),$("#ship_to").append("<span>"+i.country+"-</span>"),$("#ship_to").append("<span>"+i.zip+"</span>"),$("#shipStreet").val(e.data[1].street),$("#shipCity").val(e.data[1].city),$("#shipState").val(e.data[1].state),$("#shipZipCode").val(e.data[1].zip),$("#shipCountry").val(e.data[1].country))},error:function(e){displayErrorMessage(e.responseJSON.message)}})})),$(document).on("click","#copyBillingAddress",(function(){1==$(this).prop("checked")?($("#shipStreet").val($("#billStreet").val()),$("#shipCity").val($("#billCity").val()),$("#shipState").val($("#billState").val()),$("#shipZipCode").val($("#billZipCode").val()),$("#shipCountry").val($("#billCountry").val())):$("#shipStreet,#shipCity,#shipState,#shipZipCode,#shipCountry").val("")}))})();