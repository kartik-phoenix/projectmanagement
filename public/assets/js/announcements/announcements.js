(()=>{"use strict";$(document).on("click",".addAnnouncementModal",(function(){$("#addModal").appendTo("body").modal("show")})),$(document).on("mouseenter",".announcement-card",(function(){$(this).find(".action-dropdown").removeClass("d-none")})),$(document).on("mouseleave",".announcement-card",(function(){$(this).find(".action-dropdown").addClass("d-none"),$(this).parent().trigger("click")})),$("#announcementDate, #editAnnouncementDate").datetimepicker({format:"YYYY-MM-DD HH:mm:ss",useCurrent:!1,sideBySide:!0,widgetPositioning:{horizontal:"left",vertical:"bottom"},icons:{up:"fa fa-chevron-up",down:"fa fa-chevron-down",next:"fa fa-chevron-right",previous:"fa fa-chevron-left"},minDate:moment().subtract(1,"days")});var e=$("#announcementTable");e.DataTable({oLanguage:{sEmptyTable:Lang.get("messages.common.no_data_available_in_table"),sInfo:Lang.get("messages.common.data_base_entries"),sLengthMenu:Lang.get("messages.common.menu_entry"),sInfoEmpty:Lang.get("messages.common.no_entry"),sInfoFiltered:Lang.get("messages.common.filter_by"),sZeroRecords:Lang.get("messages.common.no_matching")},processing:!0,serverSide:!0,order:[[1,"desc"]],ajax:{url:route("announcements.index"),data:function(e){e.status=$("#filterAnnouncementStatus").find("option:selected").val(),e.showToClient=$("#showToClientId").find("option:selected").val()}},columnDefs:[{targets:[2],className:"text-center",width:"121px",orderable:!1},{targets:[3],className:"text-center",width:"68px",orderable:!1},{targets:"_all",defaultContent:"N/A"}],columns:[{data:"subject",name:"subject"},{data:function(e){if(null!=e.date)return moment(e.date,"YYYY-MM-DD hh:mm:ss").format("Do MMM, Y HH:mm A")},name:"date"},{data:function(e){var t=[{id:e.id,showToClient:e.show_to_clients}];return prepareTemplateRender("#announcementShowToClientTemplate",t)},name:"show_to_clients"},{data:function(e){var t=[{id:e.id,showUrl:route("announcements.show",e.id)}];return prepareTemplateRender("#announcementActionTemplate",t)},name:"id"}],fnInitComplete:function(){$(document).on("change","#filterAnnouncementStatus",(function(){$(e).DataTable().ajax.reload(null,!0)})),$(document).on("change","#showToClientId",(function(){$(e).DataTable().ajax.reload(null,!0)}))}}),$(document).on("submit","#addNewForm",(function(t){t.preventDefault(),processingBtn("#addNewForm","#btnSave","loading");var n=""===$("<div />").html($("#createMessage").summernote("code")).text().trim().replace(/ \r\n\t/g,"");if($("#createMessage").summernote("isEmpty"))$("#createMessage").val("");else if(n)return displayErrorMessage("Message field is not contain only white space"),processingBtn("#addNewForm","#btnSave","reset"),!1;$.ajax({url:route("announcements.store"),type:"POST",data:$(this).serialize(),success:function(t){t.success&&(displaySuccessMessage(t.message),$("#addModal").modal("hide"),e.DataTable().ajax.reload(null,!1))},error:function(e){displayErrorMessage(e.responseJSON.message)},complete:function(){processingBtn("#addNewForm","#btnSave")}})})),$(document).on("click",".edit-btn",(function(e){var t=$(e.currentTarget).data("id");renderData(t)})),window.renderData=function(e){$.ajax({url:route("announcements.edit",e),type:"GET",success:function(e){if(e.success){$("#announcementId").val(e.data.id);var t=document.createElement("textarea");t.innerHTML=e.data.subject,$("#editSubject").val(t.value),$("#editAnnouncementDate").val(moment(e.data.date).utc().format("YYYY-MM-DD HH:mm:ss")),$("#editMessage").summernote("code",e.data.message),!0===e.data.show_to_clients?$("#editShowToClients").prop("checked",!0):$("#editShowToClients").prop("checked",!1),!0===e.data.status?$("#editStatus").prop("checked",!0):$("#editStatus").prop("checked",!1),$("#editModal").appendTo("body").modal("show")}},error:function(e){displayErrorMessage(e.responseJSON.message)}})},$(document).on("submit","#editForm",(function(t){t.preventDefault(),processingBtn("#editForm","#btnEditSave","loading");var n=$("#announcementId").val(),a=""===$("<div />").html($("#editMessage").summernote("code")).text().trim().replace(/ \r\n\t/g,"");if($("#editMessage").summernote("isEmpty"))$("#editMessage").val("");else if(a)return displayErrorMessage("Message field is not contain only white space"),processingBtn("#editForm","#btnEditSave","reset"),!1;$.ajax({url:route("announcements.update",n),type:"put",data:$(this).serialize(),success:function(t){t.success&&(displaySuccessMessage(t.message),$("#editModal").modal("hide"),e.DataTable().ajax.reload(null,!1))},error:function(e){displayErrorMessage(e.responseJSON.message)},complete:function(){processingBtn("#editForm","#btnEditSave")}})})),$(document).on("click",".delete-btn",(function(){var e=$(this).attr("data-id");deleteItem(route("announcements.destroy",e),"#announcementTable",Lang.get("messages.common.announcement"))})),$("#addModal").on("show.bs.modal",(function(){$(".note-toolbar-wrapper").removeAttr("style"),$(".note-toolbar").removeAttr("style")})),$("#editModal").on("show.bs.modal",(function(){$(".note-toolbar-wrapper").removeAttr("style"),$(".note-toolbar").removeAttr("style")})),$("#addModal").on("hidden.bs.modal",(function(){resetModalForm("#addNewForm","#validationErrorsBox"),$("#createMessage").summernote("code","")})),$("#editModal").on("hidden.bs.modal",(function(){resetModalForm("#editForm","#editValidationErrorsBox")})),$(document).on("change","#showToClient",(function(){var e=$(this).attr("data-id");activeDeActiveClient(e)})),window.activeDeActiveClient=function(t){$.ajax({url:route("announcement.active.deactive.client",t),method:"post",cache:!1,beforeSend:function(){startLoader()},success:function(t){t.success&&e.DataTable().ajax.reload(null,!1)},complete:function(){stopLoader()}})},$(document).on("change","#announcementStatus",(function(){var t=$(this).attr("data-id");$.ajax({url:route("announcements.status.change",t),method:"post",cache:!1,beforeSend:function(){startLoader()},success:function(t){t.success&&(displaySuccessMessage(t.message),e.DataTable().ajax.reload(null,!1))},complete:function(){stopLoader()}})})),$(document).ready((function(){$("#filterAnnouncementStatus").select2(),$("#showToClientId").select2({width:"190px"})}))})();