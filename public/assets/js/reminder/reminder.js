(()=>{"use strict";$(document).ready((function(){$("#reminderTo,#editReminderTo").select2({width:"100%",placeholder:Lang.get("messages.reminder.reminder_to")}),$(".notified-date, .edit-notified-date").datetimepicker({format:"YYYY-MM-DD HH:mm:ss",useCurrent:!0,sideBySide:!0,widgetPositioning:{horizontal:"left",vertical:"bottom"},icons:{up:"fa fa-chevron-up",down:"fa fa-chevron-down",next:"fa fa-chevron-right",previous:"fa fa-chevron-left"}}).on("dp.show",(function(){matchWindowScreenPixels({notifiedDate:".notified-date",editNotifiedDate:".edit-notified-date"},"led")}))}));var e="#reminderTbl";$(e).DataTable({oLanguage:{sEmptyTable:Lang.get("messages.common.no_data_available_in_table"),sInfo:Lang.get("messages.common.data_base_entries"),sLengthMenu:Lang.get("messages.common.menu_entry"),sInfoEmpty:Lang.get("messages.common.no_entry"),sInfoFiltered:Lang.get("messages.common.filter_by"),sZeroRecords:Lang.get("messages.common.no_matching")},processing:!0,serverSide:!0,order:[[1,"desc"]],ajax:{url:route("reminder.index"),beforeSend:function(){startLoader()},data:function(e){e.module_id=$("#moduleId").val(),e.owner_id=$("#ownerId").val()},complete:function(){stopLoader()}},columnDefs:[{targets:[4],orderable:!1,className:"text-center",width:"8%"},{targets:[3],className:"text-center",orderable:!1,width:"4%"},{targets:[0],orderable:!1,className:"text-center",width:"11%"},{targets:[1],width:"18%"},{targets:"_all",defaultContent:"N/A"}],columns:[{data:function(e){if("App\\Models\\Customer"==e.owner_type){var t=document.createElement("textarea");return t.innerHTML=e.user.full_name,'<a href="'+route("contacts.index")+"/"+e.user.owner_id+'"><img src="'+e.user.image_url+'" class="thumbnail-rounded" data-toggle="tooltip" title="'+t.value+'"></a>'}var n=document.createElement("textarea");return n.innerHTML=e.user.full_name,'<a href="'+route("members.index")+"/"+e.user.id+'"><img src="'+e.user.image_url+'" class="thumbnail-rounded" data-toggle="tooltip" title="'+n.value+'"></a>'},name:"reminder_to"},{data:function(e){return e},render:function(e){return null===e.notified_date?"N/A":moment(e.notified_date).locale(currentLocale).format("Do MMM, Y h:mm A")},name:"notified_date"},{data:function(e){var t=document.createElement("textarea");return t.innerHTML=e.description,t.value},name:"description"},{data:function(e){return e.status?Lang.get("messages.reminder.yes"):Lang.get("messages.reminder.no")},name:"status"},{data:function(e){var t=[{id:e.id}];return prepareTemplateRender("#reminderActionTemplate",t)},name:"user.last_name"}],fnInitComplete:function(){$(document).on("change","#filterNotified",(function(){$(e).DataTable().ajax.reload(null,!0)}))}}),$(document).on("click",".addReminderModal",(function(){$("#reminderTo").val("").trigger("change"),$(".notified-date").data("DateTimePicker").date(null),$("#addModal").appendTo("body").modal("show")})),window.checkReminderContent=function(e){return!$("#"+e).summernote("isEmpty")||(displayErrorMessage("Description field is required."),!1)},$(document).on("submit","#addNewForm",(function(e){if(e.preventDefault(),checkReminderContent("reminderDescription")){processingBtn("#addNewForm","#btnCreateSave","loading");var t=""===$("<div />").html($("#reminderDescription").summernote("code")).text().trim().replace(/ \r\n\t/g,"");if($("#reminderDescription").summernote("isEmpty"))$("#reminderDescription").val("");else if(t)return displayErrorMessage("Description field is not contain only white space"),processingBtn("#addNewForm","#btnCreateSave","reset"),!1;$.ajax({url:route("reminder.store"),type:"POST",data:$(this).serialize(),success:function(e){e.success&&(displaySuccessMessage(e.message),$("#addModal").modal("hide"),$(".notified-date").data("DateTimePicker").date(null),$(".notified-date").data("DateTimePicker").date(new Date),$("#reminderTbl").DataTable().ajax.reload(null,!0))},error:function(e){displayErrorMessage(e.responseJSON.message)},complete:function(){processingBtn("#addNewForm","#btnCreateSave")}})}})),$(document).on("click",".edit-reminder-btn",(function(e){var t=$(e.currentTarget).data("id");renderEditData(t)})),window.renderEditData=function(e){$.ajax({url:route("reminder.edit",e),type:"GET",success:function(e){e.success&&($("#reminderId").val(e.data.id),$("#editNotifiedDate").val(format(e.data.notified_date,"YYYY-MM-DD HH:mm:ss")),$("#editReminderTo").val(e.data.reminder_to).trigger("change"),$("#editReminderDescription").summernote("code",e.data.description),$("#editModal").appendTo("body").modal("show"))},error:function(e){displayErrorMessage(e.responseJSON.message)}})},$(document).on("submit","#editForm",(function(e){if(e.preventDefault(),checkReminderContent("editReminderDescription")){processingBtn("#editForm","#btnEditSave","loading");var t=$("#reminderId").val(),n=""===$("<div />").html($("#editReminderDescription").summernote("code")).text().trim().replace(/ \r\n\t/g,"");if($("#editReminderDescription").summernote("isEmpty"))$("#editReminderDescription").val("");else if(n)return displayErrorMessage("Description field is not contain only white space"),processingBtn("#editForm","#btnEditSave","reset"),!1;$.ajax({url:route("reminder.update",t),type:"put",data:$(this).serialize(),success:function(e){e.success&&(displaySuccessMessage(e.message),$("#editModal").modal("hide"),$("#reminderTbl").DataTable().ajax.reload(null,!0))},error:function(e){displayErrorMessage(e.responseJSON.message)},complete:function(){processingBtn("#editForm","#btnEditSave")}})}})),$(document).on("click",".delete-reminder-btn",(function(e){var t=$(e.currentTarget).data("id");deleteItem(route("reminder.destroy",t),"#reminderTbl",Lang.get("messages.ticket.reminder"))})),$("#addModal").on("show.bs.modal",(function(){$(".note-toolbar-wrapper").removeAttr("style"),$(".note-toolbar").removeAttr("style")})),$("#editModal").on("show.bs.modal",(function(){$(".note-toolbar-wrapper").removeAttr("style"),$(".note-toolbar").removeAttr("style")})),$("#addModal").on("hidden.bs.modal",(function(){resetModalForm("#addNewForm","#validationErrorsBox"),$("#reminderDescription").summernote("code",""),$(".notified-date").val(""),$(".notified-date").data("DateTimePicker").date(null),$(".notified-date").data("DateTimePicker").date(new Date)})),$("#editModal").on("hidden.bs.modal",(function(){resetModalForm("#editForm","#editValidationErrorsBox")})),$(e).on("draw.dt",(function(){$(".tooltip").tooltip("hide"),setTimeout((function(){$('[data-toggle="tooltip"]').tooltip()}))}))})();