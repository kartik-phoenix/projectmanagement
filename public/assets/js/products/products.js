(()=>{"use strict";$(document).ready((function(){$("#filter_group").select2({width:"200px"}),$("#taxSelectOne, #editTaxSelectOne").select2({width:"100%"}),$("#taxSelectTwo,#editTaxSelectTwo").select2({width:"100%"}),$("#productGroup, #editProductGroup").select2({width:"calc(100% - 44px)",placeholder:Lang.get("messages.placeholder.select_product_group")}),$("#productDescription, #editProductDescription").summernote({minHeight:200,toolbar:[["style",["bold","italic","underline","clear"]],["font",["strikethrough"]],["para",["paragraph"]]]})}));var e=$("#productsTable");$(e).DataTable({oLanguage:{sEmptyTable:Lang.get("messages.common.no_data_available_in_table"),sInfo:Lang.get("messages.common.data_base_entries"),sLengthMenu:Lang.get("messages.common.menu_entry"),sInfoEmpty:Lang.get("messages.common.no_entry"),sInfoFiltered:Lang.get("messages.common.filter_by"),sZeroRecords:Lang.get("messages.common.no_matching")},processing:!0,serverSide:!0,order:[[0,"asc"]],ajax:{url:route("products.index"),beforeSend:function(){startLoader()},data:function(e){e.group=$("#filter_group").find("option:selected").val()},complete:function(){stopLoader()}},columnDefs:[{targets:[6],orderable:!1,className:"text-center",width:"50px"},{targets:[2],render:function(e){return e.length>80?e.substr(0,80)+"...":e}},{targets:[3,4,5],className:"text-right"},{targets:"_all",defaultContent:"N/A"}],columns:[{data:function(e){var t=document.createElement("textarea");return t.innerHTML=e.title,t.value},name:"title"},{data:function(e){var t=document.createElement("textarea");return t.innerHTML=e.group.name,t.value},name:"item_group_id"},{data:function(e){var t=document.createElement("textarea");return t.innerHTML=e.description,""!=t.value?t.value:"N/A"},name:"description"},{data:function(e){return 0!=e.rate?'<i class="'+currentCurrencyClass+'"></i> '+getFormattedPrice(e.rate):'<i class="'+currentCurrencyClass+'"></i> 0'},name:"rate"},{data:"first_tax.tax_rate",name:"firstTax.tax_rate"},{data:"second_tax.tax_rate",name:"firstTax.tax_rate"},{data:function(e){var t=[{id:e.id}];return prepareTemplateRender("#productActionTemplate",t)},name:"id"}],fnInitComplete:function(){$(document).on("change","#filter_group",(function(){e.DataTable().ajax.reload(null,!0)}))}}),$(document).on("submit","#addNewForm",(function(t){t.preventDefault(),processingBtn("#addNewForm","#btnSave","loading");var r=""===$("<div />").html($("#productDescription").summernote("code")).text().trim().replace(/ \r\n\t/g,"");if($("#productDescription").summernote("isEmpty"))$("#productDescription").val("");else if(r)return displayErrorMessage("Description field is not contain only white space"),processingBtn("#addNewForm","#btnSave","reset"),!1;$.ajax({url:route("products.store"),type:"POST",data:$(this).serialize(),success:function(t){t.success&&(displaySuccessMessage(t.message),$("#addModal").modal("hide"),e.DataTable().ajax.reload(null,!1))},error:function(e){displayErrorMessage(e.responseJSON.message)},complete:function(){processingBtn("#addNewForm","#btnSave")}})})),$(document).on("click",".edit-btn",(function(e){var t=$(e.currentTarget).data("id");renderData(t)})),window.renderData=function(e){$.ajax({url:route("products.edit",e),type:"GET",success:function(e){if(e.success){$("#productId").val(e.data.id);var t=document.createElement("textarea");t.innerHTML=e.data.title,$("#editTitle").val(t.value),$("#editProductDescription").summernote("code",e.data.description),$("#editRate").val(e.data.rate),$(".price-input").trigger("input"),$("#editTaxSelectOne").val(e.data.tax_1_id).trigger("change"),$("#editTaxSelectTwo").val(e.data.tax_2_id).trigger("change"),$("#editProductGroup").val(e.data.item_group_id).trigger("change"),$("#editModal").appendTo("body").modal("show")}},error:function(e){displayErrorMessage(e.responseJSON.message)}})},$(document).on("submit","#editForm",(function(t){t.preventDefault(),processingBtn("#editForm","#btnEditSave","loading");var r=$("#productId").val(),a=""===$("<div />").html($("#editProductDescription").summernote("code")).text().trim().replace(/ \r\n\t/g,"");if($("#editProductDescription").summernote("isEmpty"))$("#editProductDescription").val("");else if(a)return displayErrorMessage("Description field is not contain only white space"),processingBtn("#editForm","#btnEditSave","reset"),!1;$.ajax({url:route("products.update",r),type:"put",data:$(this).serialize(),success:function(t){t.success&&(displaySuccessMessage(t.message),$("#editModal").modal("hide"),e.DataTable().ajax.reload(null,!1))},error:function(e){displayErrorMessage(e.responseJSON.message)},complete:function(){processingBtn("#editForm","#btnEditSave")}})})),$(document).on("click",".delete-btn",(function(e){var t=$(e.currentTarget).data("id");deleteItem(route("products.destroy",t),"#productsTable",Lang.get("messages.common.product_1"))})),$("#addModal").on("show.bs.modal",(function(){$(".note-toolbar-wrapper").removeAttr("style"),$(".note-toolbar").removeAttr("style")})),$("#editModal").on("show.bs.modal",(function(){$(".note-toolbar-wrapper").removeAttr("style"),$(".note-toolbar").removeAttr("style")})),$("#addModal").on("hidden.bs.modal",(function(){resetModalForm("#addNewForm","#validationErrorsBox"),$("#productGroup").val("").trigger("change"),$("#taxSelectOne").val("").trigger("change"),$("#taxSelectTwo").val("").trigger("change"),$("#productDescription").summernote("code","")})),$("#editModal").on("hidden.bs.modal",(function(){resetModalForm("#editForm","#editValidationErrorsBox")})),$(document).on("submit","#addProductGroupForm",(function(e){e.preventDefault(),processingBtn("#addProductGroupForm","#btnSave","loading"),$.ajax({url:route("product-groups.store"),type:"POST",data:$(this).serialize(),success:function(e){if(e.success){displaySuccessMessage(e.message),$("#addProductGroupModal").modal("hide");var t={id:e.data.id,name:e.data.name},r=new Option(t.name,t.id,!1,!0);$("#productGroup").append(r).trigger("change")}},error:function(e){displayErrorMessage(e.responseJSON.message)},complete:function(){processingBtn("#addProductGroupForm","#btnSave")}})})),$("#addProductGroupModal").on("hidden.bs.modal",(function(){resetModalForm("#addProductGroupForm","#validationErrorsBox")})),$(document).on("submit","#editProductGroupForm",(function(e){e.preventDefault(),processingBtn("#editProductGroupForm","#btnSave","loading"),$.ajax({url:route("product-groups.store"),type:"POST",data:$(this).serialize(),success:function(e){if(e.success){displaySuccessMessage(e.message),$("#editProductGroupModal").modal("hide");var t={id:e.data.id,name:e.data.name},r=new Option(t.name,t.id,!1,!0);$("#editProductGroup").append(r).trigger("change")}},error:function(e){displayErrorMessage(e.responseJSON.message)},complete:function(){processingBtn("#editProductGroupForm","#btnSave")}})})),$("#editProductGroupModal").on("hidden.bs.modal",(function(){resetModalForm("#editProductGroupForm","#validationErrorsBox")}))})();